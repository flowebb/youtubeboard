<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Native + High-End Insight Ver 3.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #b0b0b0;
            font-size: 1.1em;
        }

        .api-key-section {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #333;
        }

        .api-key-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #4ecdc4;
        }

        .api-key-input-group {
            display: flex;
            gap: 10px;
        }

        .api-key-input-group input {
            flex: 1;
            padding: 12px 15px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .api-key-input-group input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .api-key-input-group button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .api-key-input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }

        .search-section {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #333;
        }

        .search-section h2 {
            margin-bottom: 20px;
            color: #4ecdc4;
            font-size: 1.5em;
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            color: #b0b0b0;
            font-weight: 500;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .search-button {
            grid-column: 1 / -1;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .search-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .search-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            border: 2px solid #333;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #4ecdc4;
        }

        .stat-label {
            color: #b0b0b0;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .controls-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 2px solid #333;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sort-controls label {
            color: #b0b0b0;
            font-weight: 500;
        }

        .sort-controls select {
            padding: 10px 15px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
            cursor: pointer;
        }

        .sort-controls select:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .results-section {
            margin-top: 30px;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .video-card {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #333;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
        }

        .video-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #0f0f0f;
        }

        .video-info {
            padding: 20px;
        }

        .video-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #e0e0e0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: #0f0f0f;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box-label {
            font-size: 0.8em;
            color: #b0b0b0;
            margin-bottom: 5px;
        }

        .stat-box-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #4ecdc4;
        }

        .viral-score {
            margin: 15px 0;
            padding: 12px;
            background: #0f0f0f;
            border-radius: 8px;
            text-align: center;
        }

        .viral-score-label {
            font-size: 0.8em;
            color: #b0b0b0;
            margin-bottom: 5px;
        }

        .viral-score-value {
            font-size: 1.3em;
            font-weight: 700;
        }

        .viral-score-high {
            color: #ff6b6b;
            animation: pulse 2s infinite;
        }

        .viral-score-high::after {
            content: ' ğŸ”¥';
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .viral-score-normal {
            color: #4ecdc4;
        }

        .video-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }

        .btn-secondary {
            background: #333;
            color: #e0e0e0;
        }

        .btn-secondary:hover {
            background: #444;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4ecdc4;
            font-size: 1.2em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% {
                content: '.';
            }
            40% {
                content: '..';
            }
            60%, 100% {
                content: '...';
            }
        }

        .error {
            background: #2a1a1a;
            border: 2px solid #ff6b6b;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .success-message {
            background: #1a2a1a;
            border: 2px solid #4ecdc4;
            color: #4ecdc4;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .channel-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: #0f0f0f;
            border-radius: 6px;
        }

        .channel-thumbnail {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .channel-name {
            font-size: 0.9em;
            color: #b0b0b0;
        }

        @media (max-width: 768px) {
            .video-grid {
                grid-template-columns: 1fr;
            }

            .search-form {
                grid-template-columns: 1fr;
            }

            .controls-section {
                flex-direction: column;
                align-items: stretch;
            }

            .sort-controls {
                width: 100%;
            }

            .sort-controls select {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YouTube Native + High-End Insight Ver 3.0</h1>
            <p>ê³ ê¸‰ YouTube ì˜ìƒ ë¶„ì„ ë„êµ¬</p>
        </div>

        <div class="api-key-section">
            <label for="apiKey">YouTube Data API v3 í‚¤</label>
            <div class="api-key-input-group">
                <input type="password" id="apiKey" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="saveApiKey()">ì €ì¥</button>
            </div>
            <div class="success-message" id="apiKeyMessage">API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
        </div>

        <div class="search-section">
            <h2>ê²€ìƒ‰ í•„í„°</h2>
            <form class="search-form" id="searchForm" onsubmit="handleSearch(event)">
                <div class="form-group">
                    <label for="searchQuery">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="searchQuery" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label for="order">ì •ë ¬ ìˆœì„œ</label>
                    <select id="order">
                        <option value="relevance">ê´€ë ¨ì„±</option>
                        <option value="date">ë‚ ì§œìˆœ</option>
                        <option value="rating">í‰ì ìˆœ</option>
                        <option value="title">ì œëª©ìˆœ</option>
                        <option value="viewCount">ì¡°íšŒìˆ˜ìˆœ</option>
                        <option value="videoCount">ë™ì˜ìƒ ìˆ˜ìˆœ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="videoDuration">ì˜ìƒ ê¸¸ì´</label>
                    <select id="videoDuration">
                        <option value="any">ì „ì²´</option>
                        <option value="short">ì§§ì€ ì˜ìƒ (4ë¶„ ì´í•˜)</option>
                        <option value="medium">ì¤‘ê°„ ì˜ìƒ (4-20ë¶„)</option>
                        <option value="long">ê¸´ ì˜ìƒ (20ë¶„ ì´ìƒ)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="publishedAfter">ê²Œì‹œì¼ (ì´í›„)</label>
                    <input type="date" id="publishedAfter">
                </div>
                <button type="submit" class="search-button" id="searchButton">Deep Search ì‹œì‘ (ìµœëŒ€ 200ê°œ ìˆ˜ì§‘)</button>
            </form>
        </div>

        <div class="stats-section" id="statsSection" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="totalVideos">0</div>
                <div class="stat-label">ìˆ˜ì§‘ëœ ì˜ìƒ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalViews">0</div>
                <div class="stat-label">ì´ ì¡°íšŒìˆ˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgViralScore">0%</div>
                <div class="stat-label">í‰ê·  ë–¡ìƒ ì§€ìˆ˜</div>
            </div>
        </div>

        <div class="controls-section" id="controlsSection" style="display: none;">
            <div class="sort-controls">
                <label for="sortBy">ì •ë ¬ ê¸°ì¤€:</label>
                <select id="sortBy" onchange="sortResults()">
                    <option value="viralScore">ë–¡ìƒ ì§€ìˆ˜ìˆœ</option>
                    <option value="viewCount">ì¡°íšŒìˆ˜ìˆœ</option>
                    <option value="subscriberCount">êµ¬ë…ììˆœ</option>
                </select>
            </div>
        </div>

        <div class="results-section" id="resultsSection"></div>
    </div>

    <script>
        const API_KEY_STORAGE = 'youtube_api_key';
        let currentVideos = [];
        let apiKey = '';

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            const keyInput = document.getElementById('apiKey');
            const message = document.getElementById('apiKeyMessage');
            apiKey = keyInput.value.trim();
            
            if (apiKey) {
                localStorage.setItem(API_KEY_STORAGE, apiKey);
                message.classList.add('show');
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
            } else {
                alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem(API_KEY_STORAGE);
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                apiKey = savedKey;
            }
        });

        // ê²€ìƒ‰ ì²˜ë¦¬
        async function handleSearch(event) {
            event.preventDefault();
            
            if (!apiKey) {
                alert('ë¨¼ì € API í‚¤ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const searchQuery = document.getElementById('searchQuery').value.trim();
            const order = document.getElementById('order').value;
            const videoDuration = document.getElementById('videoDuration').value;
            const publishedAfter = document.getElementById('publishedAfter').value;

            if (!searchQuery) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const searchButton = document.getElementById('searchButton');
            searchButton.disabled = true;
            searchButton.textContent = 'ê²€ìƒ‰ ì¤‘...';

            const resultsSection = document.getElementById('resultsSection');
            resultsSection.innerHTML = '<div class="loading">ì˜ìƒ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ì¤‘</div>';

            try {
                const videos = await deepSearch(searchQuery, order, videoDuration, publishedAfter);
                currentVideos = videos;
                displayResults(videos);
                updateStats(videos);
                document.getElementById('statsSection').style.display = 'flex';
                document.getElementById('controlsSection').style.display = 'flex';
            } catch (error) {
                resultsSection.innerHTML = `<div class="error">ì˜¤ë¥˜: ${error.message}</div>`;
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = 'Deep Search ì‹œì‘ (ìµœëŒ€ 200ê°œ ìˆ˜ì§‘)';
            }
        }

        // Deep Search - ìµœëŒ€ 200ê°œ ì˜ìƒ ìˆ˜ì§‘
        async function deepSearch(query, order, videoDuration, publishedAfter) {
            const API_BASE_URL = 'https://www.googleapis.com/youtube/v3';
            const MAX_RESULTS = 200;
            const RESULTS_PER_PAGE = 50;
            const MAX_PAGES = Math.ceil(MAX_RESULTS / RESULTS_PER_PAGE);
            
            let allVideos = [];
            let nextPageToken = null;
            let pageCount = 0;

            while (allVideos.length < MAX_RESULTS && pageCount < MAX_PAGES) {
                const params = new URLSearchParams({
                    part: 'snippet',
                    q: query,
                    type: 'video',
                    maxResults: RESULTS_PER_PAGE.toString(),
                    order: order,
                    key: apiKey
                });

                if (videoDuration !== 'any') {
                    params.append('videoDuration', videoDuration);
                }

                if (publishedAfter) {
                    params.append('publishedAfter', new Date(publishedAfter).toISOString());
                }

                if (nextPageToken) {
                    params.append('pageToken', nextPageToken);
                }

                const response = await fetch(`${API_BASE_URL}/search?${params}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message || 'API ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

                if (!data.items || data.items.length === 0) {
                    break;
                }

                const videoIds = data.items.map(item => item.id.videoId).join(',');
                
                // ì˜ìƒ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const detailsResponse = await fetch(
                    `${API_BASE_URL}/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${apiKey}`
                );
                const detailsData = await detailsResponse.json();

                if (detailsData.items) {
                    for (const item of detailsData.items) {
                        const videoId = item.id;
                        const snippet = item.snippet;
                        const statistics = item.statistics;
                        const channelId = snippet.channelId;

                        // ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        let channelInfo = null;
                        try {
                            const channelResponse = await fetch(
                                `${API_BASE_URL}/channels?part=snippet,statistics&id=${channelId}&key=${apiKey}`
                            );
                            const channelData = await channelResponse.json();
                            if (channelData.items && channelData.items.length > 0) {
                                channelInfo = channelData.items[0];
                            }
                        } catch (err) {
                            console.warn('ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', err);
                        }

                        const viewCount = parseInt(statistics.viewCount || 0);
                        const subscriberCount = parseInt(channelInfo?.statistics?.subscriberCount || 0);
                        const viralScore = subscriberCount > 0 ? (viewCount / subscriberCount) * 100 : 0;

                        allVideos.push({
                            videoId: videoId,
                            title: snippet.title,
                            description: snippet.description,
                            thumbnail: snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url,
                            publishedAt: snippet.publishedAt,
                            viewCount: viewCount,
                            likeCount: parseInt(statistics.likeCount || 0),
                            commentCount: parseInt(statistics.commentCount || 0),
                            channelId: channelId,
                            channelTitle: snippet.channelTitle,
                            channelThumbnail: channelInfo?.snippet?.thumbnails?.default?.url || '',
                            subscriberCount: subscriberCount,
                            viralScore: viralScore
                        });
                    }
                }

                nextPageToken = data.nextPageToken;
                pageCount++;

                if (!nextPageToken) {
                    break;
                }

                // API í• ë‹¹ëŸ‰ ê³ ë ¤í•˜ì—¬ ì•½ê°„ì˜ ì§€ì—°
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            return allVideos.slice(0, MAX_RESULTS);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(videos) {
            const resultsSection = document.getElementById('resultsSection');
            
            if (videos.length === 0) {
                resultsSection.innerHTML = '<div class="error">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const videoGrid = document.createElement('div');
            videoGrid.className = 'video-grid';

            videos.forEach(video => {
                const card = createVideoCard(video);
                videoGrid.appendChild(card);
            });

            resultsSection.innerHTML = '';
            resultsSection.appendChild(videoGrid);
        }

        // ì˜ìƒ ì¹´ë“œ ìƒì„±
        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';

            const viralScoreClass = video.viralScore >= 10000 ? 'viral-score-high' : 'viral-score-normal';
            const viralScoreText = video.viralScore.toFixed(2) + '%';

            card.innerHTML = `
                <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'200\\'%3E%3Crect fill=\\'%230f0f0f\\' width=\\'400\\' height=\\'200\\'/%3E%3Ctext fill=\\'%23333\\' font-family=\\'sans-serif\\' font-size=\\'20\\' x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dominant-baseline=\\'middle\\'%3Eì¸ë„¤ì¼ ì—†ìŒ%3C/text%3E%3C/svg%3E'">
                <div class="video-info">
                    <div class="channel-info">
                        <img src="${video.channelThumbnail || 'data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'30\\' height=\\'30\\'%3E%3Ccircle cx=\\'15\\' cy=\\'15\\' r=\\'15\\' fill=\\'%23333\\'/%3E%3C/svg%3E'}" alt="${video.channelTitle}" class="channel-thumbnail" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'30\\' height=\\'30\\'%3E%3Ccircle cx=\\'15\\' cy=\\'15\\' r=\\'15\\' fill=\\'%23333\\'/%3E%3C/svg%3E'">
                        <span class="channel-name">${video.channelTitle}</span>
                    </div>
                    <div class="video-title">${video.title}</div>
                    <div class="video-stats">
                        <div class="stat-box">
                            <div class="stat-box-label">ì¡°íšŒìˆ˜</div>
                            <div class="stat-box-value">${formatNumber(video.viewCount)}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-label">êµ¬ë…ì</div>
                            <div class="stat-box-value">${formatNumber(video.subscriberCount)}</div>
                        </div>
                    </div>
                    <div class="viral-score">
                        <div class="viral-score-label">ë–¡ìƒ ì§€ìˆ˜ (Viral Score)</div>
                        <div class="viral-score-value ${viralScoreClass}">${viralScoreText}</div>
                    </div>
                    <div class="video-actions">
                        <button class="btn btn-primary" onclick="copyAnalysisPrompt('${video.videoId}', ${JSON.stringify(video).replace(/'/g, "&#39;")})">AI ê¸°íš</button>
                        <button class="btn btn-secondary" onclick="window.open('https://www.youtube.com/watch?v=${video.videoId}', '_blank')">YouTube ë³´ê¸°</button>
                    </div>
                </div>
            `;

            return card;
        }

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(1) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(videos) {
            const totalVideos = videos.length;
            const totalViews = videos.reduce((sum, v) => sum + v.viewCount, 0);
            const avgViralScore = videos.length > 0 
                ? videos.reduce((sum, v) => sum + v.viralScore, 0) / videos.length 
                : 0;

            document.getElementById('totalVideos').textContent = totalVideos;
            document.getElementById('totalViews').textContent = formatNumber(totalViews);
            document.getElementById('avgViralScore').textContent = avgViralScore.toFixed(2) + '%';
        }

        // ê²°ê³¼ ì •ë ¬
        function sortResults() {
            const sortBy = document.getElementById('sortBy').value;
            let sortedVideos = [...currentVideos];

            switch (sortBy) {
                case 'viralScore':
                    sortedVideos.sort((a, b) => b.viralScore - a.viralScore);
                    break;
                case 'viewCount':
                    sortedVideos.sort((a, b) => b.viewCount - a.viewCount);
                    break;
                case 'subscriberCount':
                    sortedVideos.sort((a, b) => b.subscriberCount - a.subscriberCount);
                    break;
            }

            displayResults(sortedVideos);
        }

        // AI ë¶„ì„ í”„ë¡¬í”„íŠ¸ ë³µì‚¬
        function copyAnalysisPrompt(videoId, video) {
            const prompt = `ë‹¤ìŒ YouTube ì˜ìƒì„ ë¶„ì„í•´ì£¼ì„¸ìš”:

ì˜ìƒ ì œëª©: ${video.title}
ì±„ë„ëª…: ${video.channelTitle}
ì¡°íšŒìˆ˜: ${formatNumber(video.viewCount)}
êµ¬ë…ì ìˆ˜: ${formatNumber(video.subscriberCount)}
ë–¡ìƒ ì§€ìˆ˜ (Viral Score): ${video.viralScore.toFixed(2)}%
ì¢‹ì•„ìš” ìˆ˜: ${formatNumber(video.likeCount)}
ëŒ“ê¸€ ìˆ˜: ${formatNumber(video.commentCount)}
ê²Œì‹œì¼: ${new Date(video.publishedAt).toLocaleDateString('ko-KR')}

ì˜ìƒ URL: https://www.youtube.com/watch?v=${videoId}

ì´ ì˜ìƒì˜ ì„±ê³µ ìš”ì¸, ì½˜í…ì¸  ì „ëµ, íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤, ê°œì„ ì  ë“±ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.`;

            navigator.clipboard.writeText(prompt).then(() => {
                const message = document.createElement('div');
                message.className = 'success-message show';
                message.textContent = 'ë¶„ì„ í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                message.style.position = 'fixed';
                message.style.top = '20px';
                message.style.right = '20px';
                message.style.zIndex = '10000';
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.classList.remove('show');
                    setTimeout(() => message.remove(), 300);
                }, 3000);
            }).catch(err => {
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.\n\n' + prompt);
            });
        }
    </script>
</body>
</html>

